import os
import time
from datetime import datetime, timedelta
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

# Configuración del correo electrónico
correo = 'tu_correo@gmail.com'
contraseña = 'tu_contraseña'
destinatario = 'destinatario@gmail.com'

# Configuración del directorio a monitorear
directorio = 'ruta_del_directorio_a_monitorear'

def enviar_correo(cambios):
    msg = MIMEMultipart()
    msg['From'] = correo
    msg['To'] = destinatario
    msg['Subject'] = 'Cambios en el directorio en las últimas 24 horas'
    message = 'Se han detectado los siguientes cambios en el directorio en las últimas 24 horas:\n\n' + '\n'.join(cambios)
    msg.attach(MIMEText(message))

    mailServer = smtplib.SMTP('smtp.gmail.com', 587)
    mailServer.starttls()
    mailServer.login(correo, contraseña)
    mailServer.sendmail(correo, destinatario, msg.as_string())
    mailServer.close()

def monitorear_directorio():
    cambios = []
    ahora = datetime.now()
    ayer = ahora - timedelta(days=1)
    for raiz, dirs, archivos in os.walk(directorio):
        for archivo in archivos:
            ruta_archivo = os.path.join(raiz, archivo)
            tiempo_modificacion = datetime.fromtimestamp(os.path.getmtime(ruta_archivo))
            if tiempo_modificacion > ayer:
                cambios.append(f'Archivo modificado: {ruta_archivo}')
            tiempo_creacion = datetime.fromtimestamp(os.path.getctime(ruta_archivo))
            if tiempo_creacion > ayer:
                cambios.append(f'Archivo creado: {ruta_archivo}')
    if cambios:
        enviar_correo(cambios)

if __name__ == "__main__":
    while True:
        monitorear_directorio()
        time.sleep(86400) # Esperar 24 horas antes de volver a ejecutar